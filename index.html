<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>AR Menu experience</title>
    <script src="https://cdn.jsdelivr.net/npm/mrjs@latest/dist/mr.js"></script>
    <!-- <script src="./dist/mr.js"></script> -->
    <link rel="stylesheet" type="text/css" href="style.css" />
</head>

<body>

    <mr-app debug="true" class="app">
        <mr-light color="white" intensity="1" data-position="0 1 0.5"></mr-light>


        <!-- <mr-button style="margin-left: 10px;" onclick="switchTab(0)">Dish</mr-button>
                <mr-button style="margin-left: 10px;" onclick="switchTab(1)">Recipe</mr-button>
                <mr-button style="margin-left: 10px;" onClick="switchTab(2)">Items</mr-button>
                <mr-button style="margin-left: 10px;" onClick="spread()">spread</mr-button> -->
        <!-- </mr-panel> -->

        <!-- <mr-entity data-comp-anchor="type: floating;">

            <mr-panel id="nav">

                <mr-div class="nav">
                   

                    <mr-button style="margin-left: 10px;" onclick="togglePanelVisibility()">test</mr-button>
                </mr-div>
            </mr-div> -->

            <mr-panel id="panel" class="stack" style="visibility: hidden;">
                <mr-div class="information">
                    <mr-div class="tight-stack">
                        <mr-text id="name">loading</mr-text>
                        <mr-text id="cuisine">loading</mr-text>

                    </mr-div>
                    <mr-text id="desc">loading</mr-text>
                    <mr-text id="allergens">loading</mr-text>
                </mr-div>
            </mr-panel>

            <mr-entity id="objects">
                <mr-div class="illustration">
                    <mr-div id="models" onclick="togglePanelVisibility()">
                        <mr-div id="models">

                        </mr-div>
                    </mr-div>
                </mr-div>
            </mr-entity>

        </mr-entity>

        <mr-entity id="rig" data-comp-anchor="type:plane; label: table;">
            <mr-model class="spbutton" data-position="0.09 0 0.5" onclick="App.prev()" src="
                ./buttonprev.glb"></mr-model>
            <mr-model class="spbutton" data-position="-0.09 0 0.5" data-rotation=" 0 0 0" onclick="App.next()" src="./buttonnext.glb"></mr-model>
            <mr-model class="test" data-position="-0.001 0 0.5"  onclick="togglePanelVisibility()" src="./test.glb"></mr-model>

        </mr-entity>


        <mr-volume id="volume" data-position="0.05 0.5 -0.5" data-comp-anchor="type: plane; label:table;">
            <mr-food id="food"></mr-food>
            <mr-entity id="food-models"></mr-entity>

            <mr-div class="illustration">
                <mr-div id="models" style="z-index: 100"></mr-div>
            </mr-div>

        </mr-volume>




        <!-- fix food placement  -->


    </mr-app>
</body>


<script>
    let rig = document.querySelector('#rig')
    let panels = document.querySelectorAll('.layout')

    let frontIndex = 0

    function switchTab(index) {
        panels[frontIndex].classList.remove('front')
        panels[index].classList.add('front')
        frontIndex = index
    }

    let unfolded = false

    function spread() {
        let index = 0
        let totalWidth = 0

        let forwardVec = getForward(rig)

        for (let panel of panels) {

            totalWidth += panel.width
        }

        for (let panel of panels) {
            if (unfolded) {
                panel.object3D.position.set(0, 0, 0)
            } else {
                panel.object3D.position.set(((panel.width) * index) - (totalWidth / panels.length), 0, ((index + 1) % 2) * 0.3)
                index += 1
            }
            panel.object3D.lookAt(forwardVec)


        }

        unfolded = !unfolded

    }


    function getForward(entity) {

        let localForward = new THREE.Vector3(0, 0, 0.5);

        let worldForward = entity.object3D.localToWorld(localForward)

        return worldForward.applyQuaternion(entity.object3D.quaternion);

    }

    document.addEventListener('exitXR', () => {
        unfolded = false;
        spread()
    })


</script>

<script>
    function togglePanelVisibility() {
        var panel = document.getElementById('panel');

        if (panel.style.visibility === 'hidden' || panel.style.visibility === '') {
            panel.style.visibility = 'visible';
        } else {
            panel.style.visibility = 'hidden';
        }
    }
</script>

<script src="script.js"></script>

</html>